{% extends "base.html" %}
{% block title %}Cheque Entry Â· SHK CMS{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Cheque Entry</h1>

<div class="card shadow-sm">
  <div class="card-body">
    <form id="entryForm" method="POST" action="/chequeentry" class="row g-3">
      <div class="col-12 col-sm-6">
        <label class="form-label">Bank</label>
        <select class="form-select" name="bank" id="bank" required>
          <option value="ICICI">ICICI</option>
          <option value="HDFC">HDFC</option>
          <option value="HDFC Athiyan">HDFC Athiyan</option>
        </select>
      </div>

      <div class="col-6 col-sm-3">
        <label class="form-label">Post Date</label>
        <input type="date" class="form-control" name="rdate" id="rdate" required>
      </div>
      <div class="col-6 col-sm-3">
        <label class="form-label">Cheque No</label>
        <input type="number" class="form-control" name="chqno" id="chqno" required>
      </div>

      <div class="col-12 col-sm-6">
        <label class="form-label">Vendor</label>
        <select class="form-select" name="vendor" id="vendor" required>
          <option value="" disabled selected>Select Vendor</option>
          {% for v in vendor_list %}
          <option value="{{ v }}">{{ v }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-6 col-sm-3">
        <label class="form-label">Amount</label>
        <input type="number" class="form-control" name="amount" id="amount" required>
      </div>
      <div class="col-6 col-sm-3">
        <label class="form-label">Issue Date</label>
        <input type="date" class="form-control" name="idate" id="idate" required>
      </div>

      <div class="col-12">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-plus-circle"></i> Add
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Last 5 -->
<div class="card shadow-sm mt-4">
  <div class="card-header bg-white"><strong>Last 5 Cheques</strong></div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>ID</th><th>Bank</th><th>Cheque No</th><th class="text-end">Amount</th>
            <th>Issue Date</th><th>Realisation Date</th><th>Vendor</th><th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for row in records %}
          <tr>
            <td>{{ row.id }}</td>
            <td>{{ row.bank }}</td>
            <td>{{ row.cheque_no }}</td>
            <td class="text-end">{{ row.amount }}</td>
            <td>{{ row.issue_date }}</td>
            <td>{{ row.post_date }}</td>
            <td>{{ row.vendor }}</td>
            <td>
              {% if row.status == 'Active' %}<span class="badge bg-warning text-dark">Active</span>
              {% elif row.status == 'Cashed' %}<span class="badge bg-success">Cashed</span>
              {% elif row.status == 'Cancelled' %}<span class="badge bg-secondary">Cancelled</span>
              {% elif row.status == 'Bounced' %}<span class="badge bg-danger">Bounced</span>
              {% elif row.status == 'Mistake' %}<span class="badge bg-dark">Mistake</span>
              {% else %}-{% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Cheque Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body small">
        <div class="row g-2">
          <div class="col-6"><strong>Bank:</strong> <span id="cBank"></span></div>
          <div class="col-6"><strong>Post Date:</strong> <span id="cPost"></span></div>
          <div class="col-6"><strong>Cheque No:</strong> <span id="cNo"></span></div>
          <div class="col-6"><strong>Vendor:</strong> <span id="cVendor"></span></div>
          <div class="col-6"><strong>Amount:</strong> <span id="cAmt"></span></div>
          <div class="col-6"><strong>Issue Date:</strong> <span id="cIssue"></span></div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="modifyBtn" type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Modify</button>
        <button id="saveBtn" type="button" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block body_extra %}
<script>
  const form = document.getElementById('entryForm');
  const modalEl = document.getElementById('confirmModal');
  const modal = new bootstrap.Modal(modalEl);

  form.addEventListener('submit', function(e){
    e.preventDefault();
    cBank.textContent   = bank.value;
    cPost.textContent   = rdate.value;
    cNo.textContent     = chqno.value;
    cVendor.textContent = vendor.value;
    cAmt.textContent    = amount.value;
    cIssue.textContent  = idate.value;
    modal.show();
  });

  document.getElementById('saveBtn').addEventListener('click', () => form.submit());
</script>
{% endblock %}
